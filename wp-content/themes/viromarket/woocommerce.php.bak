<?php
/**
 * The template for displaying all WooCommerce pages
 *
 * @package ViroMarket
 */

get_header();
?>

<main>
    <div class="container-website page-content">
        
        <?php
        // Check if it's the shop page or product archive
        if ( is_shop() || is_product_category() || is_product_tag() ) :
        ?>
        
        <!-- Breadcrumbs -->
        <?php if ( function_exists( 'woocommerce_breadcrumb' ) ) : ?>
            <nav class="breadcrumbs" aria-label="Breadcrumb">
                <?php woocommerce_breadcrumb(); ?>
            </nav>
        <?php endif; ?>

        <!-- Page Header -->
        <div class="page-header-simple">
            <?php if ( apply_filters( 'woocommerce_show_page_title', true ) ) : ?>
                <h1 class="page-title"><?php woocommerce_page_title(); ?></h1>
            <?php endif; ?>
        </div>

        <!-- Products Page Layout -->
        <div class="products-page-layout">
            
            <!-- Sidebar Filters -->
            <aside class="products-sidebar" id="productsSidebar">
                
                <!-- Categories Filter -->
                <div class="filter-group">
                    <h3 class="filter-title">
                        <?php _e( 'Categories', 'viromarket' ); ?>
                        <i data-lucide="chevron-up"></i>
                    </h3>
                    <div class="filter-options">
                        <?php
                        $product_categories = get_terms( array(
                            'taxonomy'   => 'product_cat',
                            'hide_empty' => true,
                            'parent'     => 0,
                        ) );
                        
                        if ( ! empty( $product_categories ) && ! is_wp_error( $product_categories ) ) {
                            foreach ( $product_categories as $category ) {
                                $count = $category->count;
                                $cat_link = get_term_link( $category );
                                $is_current = is_product_category( $category->slug );
                                ?>
                                <label class="filter-item">
                                    <a href="<?php echo esc_url( $cat_link ); ?>" style="display: flex; justify-content: space-between; width: 100%; text-decoration: none; color: inherit;">
                                        <span class="item-label"><?php echo esc_html( $category->name ); ?></span>
                                        <span class="item-count">(<?php echo esc_html( $count ); ?>)</span>
                                    </a>
                                </label>
                                <?php
                            }
                        }
                        ?>
                    </div>
                </div>

                <!-- Price Filter -->
                <div class="filter-group">
                    <h3 class="filter-title">
                        <?php _e( 'Price Range', 'viromarket' ); ?>
                        <i data-lucide="chevron-up"></i>
                    </h3>
                    <div class="filter-options">
                        <?php the_widget( 'WC_Widget_Price_Filter' ); ?>
                    </div>
                </div>

                <!-- Additional Filters -->
                <?php if ( is_active_sidebar( 'sidebar-shop' ) ) : ?>
                    <?php dynamic_sidebar( 'sidebar-shop' ); ?>
                <?php endif; ?>

            </aside>

            <!-- Main Products Section -->
            <section class="products-grid-section">
                
                <!-- Toolbar -->
                <div class="products-toolbar">
                    <div class="toolbar-left">
                        <?php do_action( 'woocommerce_before_shop_loop' ); ?>
                    </div>
                    <div class="toolbar-right">
                        <div class="view-toggles">
                            <button class="view-btn active" id="gridView" aria-label="Grid View">
                                <i data-lucide="grid"></i>
                            </button>
                            <button class="view-btn" id="listView" aria-label="List View">
                                <i data-lucide="list"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Products Grid -->
                <?php
                if ( woocommerce_product_loop() ) {
                    ?>
                    <div class="products-grid" id="productGrid">
                        <?php
                        if ( wc_get_loop_prop( 'total' ) ) {
                            while ( have_posts() ) {
                                the_post();
                                do_action( 'woocommerce_shop_loop' );
                                wc_get_template_part( 'content', 'product' );
                            }
                        }
                        ?>
                    </div>
                    <?php
                    do_action( 'woocommerce_after_shop_loop' );
                } else {
                    do_action( 'woocommerce_no_products_found' );
                }
                ?>

            </section>

        </div><!-- .products-page-layout -->
        
        <?php else : ?>
            
            <!-- For other WooCommerce pages (single product, cart, checkout, etc.) -->
            <?php woocommerce_content(); ?>
            
        <?php endif; ?>

    </div><!-- .container-website -->
</main>

<?php
get_footer();
?>
